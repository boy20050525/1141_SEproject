<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>{{ job["title"] }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Noto Sans TC', sans-serif;
    }

    body {
      margin: 0;
      background-color: #f7f3ef;
      color: #3b2f2f;
      line-height: 1.6;
    }

    header {
      background-color: #e9dfd0;
      padding: 20px 40px;
      text-align: center;
      border-bottom: 2px solid #d4c7b5;
    }

    header h2 {
      margin: 0;
      font-size: 28px;
      color: #3e2e1e;
    }

    main {
      max-width: 900px;
      background-color: #fffdfa;
      margin: 40px auto;
      padding: 35px 45px;
      border-radius: 15px;
      box-shadow: 0 5px 18px rgba(80, 70, 60, 0.15);
    }

    h3 {
      border-left: 6px solid #c2a676;
      padding-left: 12px;
      font-size: 22px;
      margin-top: 35px;
      color: #4b3c2b;
    }

    p {
      font-size: 16px;
      margin-bottom: 8px;
    }

    a {
      color: #7a5e3e;
      text-decoration: none;
      font-weight: 600;
    }

    a:hover {
      text-decoration: underline;
      color: #5a4632;
    }

    hr {
      border: none;
      border-top: 2px solid #e4d6c4;
      margin: 30px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
      background-color: #fffaf3;
      box-shadow: 0 2px 10px rgba(120, 100, 80, 0.1);
      margin-top: 15px;
      margin-bottom: 25px;
    }

    th, td {
      padding: 14px 16px;
      text-align: center;
      font-size: 15px;
    }

    th {
      background-color: #e9dfd0;
      color: #3a2a1a;
      font-weight: 700;
    }

    tr:nth-child(even) {
      background-color: #f6f1ea;
    }

    tr:hover {
      background-color: #f0e4d5;
      transition: background-color 0.2s ease;
    }

    input[type="number"],
    input[type="file"],
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #cdbda3;
      background-color: #fffdf9;
      margin-top: 6px;
      font-size: 15px;
    }

    button {
      background-color: #c2a676;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #a88752;
    }

    .danger-btn {
      background-color: #ef4444;
      color: white;
    }

    .danger-btn:hover {
      background-color: #c53030;
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #7a6b5b;
    }
  </style>
</head>

<body>
  <header>
    <h2>{{ job["title"] }}</h2>
  </header>

  <main>
    <p><b>å…§å®¹ï¼š</b> {{ job["content"] }}</p>
    <p><b>ç‹€æ…‹ï¼š</b> {{ job["status"] }}</p>
    <p><b>é ç®—ï¼š</b> ${{ job["budget"] }}</p>
    <p><b>å§”è¨—äººï¼š</b> {{ job["client_name"] }}</p>
    <p><b>æ¥æ¡ˆäººï¼š</b> {{ job["freelancer_name"] or "å°šæœªé¸æ“‡" }}</p>
    
    {% if job["requirement_file"] %}
    <p><b>éœ€æ±‚æ–‡ä»¶ï¼š</b>
    <a href="/download_requirement/{{ job['id'] }}" target="_blank" style="color:#7a5e3e; font-weight:600; text-decoration:none;">
      ğŸ“„ ä¸‹è¼‰ {{ job["requirement_file"].split('/')[-1] }}
    </a>
    </p>
    {% endif %}

    <hr>

    {% set role = request.session.get("role") %}
    {% set user_id = request.session.get("user_id") %}
    
    <p>
      <a href="/">ğŸ  å›é¦–é </a>ã€€
      {% if role == "ç”²æ–¹" %}
        <a href="/dashboard_client">ğŸ“‚ å›æ§åˆ¶å°</a>
      {% elif role == "ä¹™æ–¹" %}
        <a href="/dashboard_freelancer">ğŸ› ï¸ å›æ§åˆ¶å°</a>
      {% endif %}
    </p>

    {% if role == "ä¹™æ–¹" and (job["status"] == "æ–°å·¥ä½œ" or job["status"] == "å¾…ç¢ºèª") %}
    <h3>ğŸ’° æˆ‘è¦å ±åƒ¹</h3>
    <form action="/bid" method="post">
      <input type="hidden" name="job_id" value="{{ job['id'] }}">
      <label>è«‹è¼¸å…¥ä½ é¡˜æ„æ¥æ¡ˆçš„åƒ¹æ ¼ï¼š</label><br>
      <input type="number" name="amount" min="{{ job['budget'] }}" required><br><br>
      <button type="submit">ğŸ“¤ é€å‡ºå ±åƒ¹</button>
    </form>

    {% if bids %}
    <h4>ğŸ“Š ç›®å‰å·²å ±åƒ¹ä¹™æ–¹ï¼š</h4>
    <table border="1" cellpadding="6" cellspacing="0">
      <tr>
        <th>åæ¬¡</th>
        <th>ä¹™æ–¹åç¨±</th>
        <th>å ±åƒ¹é‡‘é¡</th>
        <th>æ™‚é–“</th>
      </tr>
      {% for bid in bids %}
      <tr {% if loop.first %} style="background:#e8ffe8;font-weight:bold;" {% endif %}>
        <td>{{ loop.index }}</td>
        <td>{{ bid["username"] }}</td>
        <td>${{ bid["amount"] }}</td>
        <td>{{ bid["created_at"] }}</td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}
    {% endif %}

    {% if role == "ç”²æ–¹" and (job["status"] == "æ–°å·¥ä½œ" or job["status"] == "å¾…ç¢ºèª") %}
    <h3>ğŸ“Š å·²å ±åƒ¹ä¹™æ–¹æ¸…å–®</h3>
    {% if bids %}
    <table border="1" cellpadding="6" cellspacing="0">
      <tr>
        <th>åæ¬¡</th>
        <th>ä¹™æ–¹åç¨±</th>
        <th>å ±åƒ¹é‡‘é¡</th>
        <th>å ±åƒ¹æ™‚é–“</th>
        <th>æ“ä½œ</th>
      </tr>
      {% for bid in bids %}
      <tr {% if loop.first %} style="background:#e8ffe8;font-weight:bold;" {% endif %}>
        <td>{{ loop.index }}</td>
        <td>{{ bid["username"] }}</td>
        <td>${{ bid["amount"] }}</td>
        <td>{{ bid["created_at"] }}</td>
        <td>
          <form action="/chooseBid" method="post">
            <input type="hidden" name="job_id" value="{{ job['id'] }}">
            <input type="hidden" name="freelancer_id" value="{{ bid['bidder_id'] }}">
            <button type="submit">âœ… é¸æ“‡æ­¤ä¹™æ–¹</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
    {% else %}
    <p>ç›®å‰å°šç„¡ä¹™æ–¹å ±åƒ¹ã€‚</p>
    {% endif %}
    {% endif %}

    {% if role == "ä¹™æ–¹" and job["status"] == "é€²è¡Œä¸­" and job["freelancer_name"] == request.session.get("username") %}
    <h3>ğŸ“¦ ä¸Šå‚³æˆæœ</h3>
    <form action="/api/upload" method="post" enctype="multipart/form-data">
      <input type="hidden" name="job_id" value="{{ job['id'] }}">
      <input type="file" name="uploadedFile" required>
      <button type="submit">ğŸ“¤ ä¸Šå‚³æˆæœ</button>
    </form>
    {% endif %}

    {% if role == "ç”²æ–¹" and job["status"] == "ä¸Šå‚³æˆæœ" %}
    <h3>ğŸ“¦ æˆæœå¯©æ ¸å€</h3>
    <p><a href="/download/{{ job['id'] }}">ğŸ“¥ ä¸‹è¼‰ä¹™æ–¹ä¸Šå‚³çš„æˆæœæª”æ¡ˆ</a></p>

    <form action="/completeJob" method="post" style="margin-bottom:10px;">
      <input type="hidden" name="job_id" value="{{ job['id'] }}">
      <button type="submit">âœ… ç¢ºèªçµæ¡ˆ</button>
    </form>

    <form action="/rejectJob" method="post">
      <input type="hidden" name="job_id" value="{{ job['id'] }}">
      <label>é€€ä»¶ç†ç”±ï¼š</label><br>
      <textarea name="reason" rows="3" cols="50" required></textarea><br>
      <button type="submit" class="danger-btn">âŒ é€€ä»¶</button>
    </form>
    {% endif %}

    {% if role == "ç”²æ–¹" and job["client_name"] == username %}
      <p><a href="/editJobForm/{{ job['id'] }}" style="color:#a88752;">âœï¸ ç·¨è¼¯æ­¤æ¡ˆä»¶</a></p>
    {% endif %}

    {% if role == "ä¹™æ–¹" and job["status"] == "é€²è¡Œä¸­" and deliverable and deliverable["reject_reason"] %}
    <hr>
    <p style="color:red;"><b>â— é€€ä»¶ç†ç”±ï¼š</b> {{ deliverable["reject_reason"] }}</p>
    {% endif %}

    {% if job["status"] == "å·²å®Œæˆ" %}
    <hr>
    <p style="color:green;"><b>âœ… æ¡ˆä»¶å·²çµæ¡ˆï¼Œæ„Ÿè¬åˆä½œï¼</b></p>
    {% endif %}
  </main>

  <footer>Â© 2025 å·¥ä½œå§”è¨—å¹³å° | æ¡ˆä»¶è©³æƒ…é </footer>
</body>
</html>
